// Generated by CoffeeScript 1.10.0
(function() {
  var Table, _, crypto, debug, prompt,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  debug = require('debug')('coding:BaseModel');

  _ = require('lodash');

  Table = require('cli-table');

  prompt = require('prompt');

  crypto = require('crypto');

  module.exports = (function() {
    function exports(cmd) {
      this.cmd = cmd;
      this.transport = bind(this.transport, this);
      this.showData = bind(this.showData, this);
      this.parseParames = bind(this.parseParames, this);
      this._init = bind(this._init, this);
      this.load = bind(this.load, this);
      this._init();
    }

    exports.prototype.load = function(model) {
      return require("./Models/" + model)(this.cmd);
    };

    exports.prototype._init = function() {
      var i18n;
      this.debug = require('debug')("coding:Models:" + this.constructor.name);
      if (this.cmd.opts.modules) {
        if (!_.includes(this.cmd.opts.modules, this.constructor.name)) {
          debug(this.constructor.name);
          return;
        }
      }
      prompt.start();
      prompt.message = "Coding";
      i18n = require('i18n');
      i18n.configure({
        locales: ['Jpan', 'en', 'zh-CN', 'zh-TW'],
        directory: __dirname + '/../locales'
      });
      i18n.setLocale(this.cmd.opts.lang);
      this.__ = i18n.__;
      this.program = this.cmd.program;
      this.coding = this.cmd.coding;
      this.opts = this.cmd.opts;
      this.prompt = prompt;
      this.transport = this.cmd.opts.transport || this.transport;
      this.table = new Table;
      if (this.init != null) {
        return this.init();
      }
    };

    exports.prototype.parseParames = function(raw, header, query, body, formData) {
      var key, params, sha1;
      params = {
        "headers": {},
        "qs": {},
        "form": {}
      };
      for (key in raw) {
        if (!_.isEmpty(raw[key])) {
          if (_.includes(["password", "confirm_password", "current_password"], key)) {
            sha1 = crypto.createHash('sha1');
            sha1.update(raw[key]);
            raw[key] = sha1.digest('hex');
          }
          if (_.includes(header, key)) {
            params.headers[key] = raw[key];
          }
          if (_.includes(query, key)) {
            params.qs[key] = raw[key];
          }
          if (_.includes(body, key)) {
            params.form[key] = raw[key];
          }
        }
      }
      return params;
    };

    exports.prototype.showData = function(data) {
      if (data.code !== 0) {
        return this.transport(data.msg);
      } else {
        return this.transport(data.data);
      }
    };

    exports.prototype.transport = function(data) {
      var key;
      for (key in data) {
        this.table.push([this.__(this.constructor.name + "." + key), data[key]]);
      }
      return console.log(this.table.toString());
    };

    return exports;

  })();

}).call(this);
